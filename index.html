<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>  
<header class="hero">
  <h1>日の出屋製菓をもっと有名にしたい！</h1>
  <p class="subtitle">作成:南砺福野高等学校13H</p>
</header>

<nav class="toc">
  <h2>目次</h2>
  <ol>
    <li><a href="#purpose">目的</a></li>
    <li><a href="#result">アンケート結果</a></li>
    <li><a href="#features">それぞれの特徴</a></li>
  </ol>
  <ul class="toc-sub">
    <li><a href="#product-a">商品A</a></li>
    <li><a href="#product-b">商品B</a></li>
    <li><a href="#product-c">商品C</a></li>
    <li><a href="#product-d">商品D</a></li>
  </ul>
</nav>

<section id="purpose" class="section">
  <h2>1. なぜサイトを作ったのか</h2>
  <p>
私たち南砺福野高等学校がある南砺市には、米菓の老舗企業・日の出屋製菓があります。日の出屋製菓は、複数のブランドを展開する「マルチブランド戦略」により、さまざまなお客様のニーズに応える商品を手掛けています。どの商品もとても美味しいのですが、その魅力が十分に伝わっていないのではないかと感じました。そこで私たちは、より多くの方に日の出屋製菓の魅力を知っていただくためにアンケート調査を行い、このウェブサイトを制作しました。
  </p>
</section>

<section id="result" class="section">
  <h2>2. アンケート結果</h2>
  <p>私たちは知名度の視覚化につながるのではないかと思い、日の出屋製菓の商品の中で好きなものは何か、またおいしそうに感じるものは何かと、どうしてそれを選んだのかというアンケートを実施しました。以下がその結果です。</p>
  <div class="survey-box">

    <h3 class="sub-title">好きな商品と、おいしそうに感じる商品の比較</h3>

    <div class="graph-legend">
      <span class="legend-box" style="background:#d14a1f;"></span> 好きな商品
      <span class="legend-box" style="background:#e8c59a;"></span> おいしそうな商品
    </div>

    <div class="double-bar-wrapper">
      <div class="double-item">
        <p class="item-label">商品A</p>
        <div class="bars">
          <div class="bar-like" style="height: 80px; --w:80px;"></div>
          <div class="bar-look" style="height: 60px; --w:60px;"></div>
        </div>
      </div>

      <div class="double-item">
        <p class="item-label">商品B</p>
        <div class="bars">
          <div class="bar-like" style="height: 80px; --w:50px;"></div>
          <div class="bar-look" style="height: 60px; --w:90px;"></div>
        </div>
      </div>

      <div class="double-item">
        <p class="item-label">商品C</p>
        <div class="bars">
          <div class="bar-like" style="height: 80px; --w:30px;"></div>
          <div class="bar-look" style="height: 60px; --w:40px;"></div>
        </div>
      </div>

      <div class="double-item">
        <p class="item-label">商品D</p>
        <div class="bars">
          <div class="bar-like" style="height: 80px; --w:20px;"></div>
          <div class="bar-look" style="height: 60px; --w:25px;"></div>
        </div>
      </div>
    </div>

  </div> <!-- ← survey-box の閉じタグ、ここでOK -->

  <!-- 理由：商品A -->
  <div class="reason-block">
    <h3 class="reason-title">商品A の選んだ理由</h3>
    <div class="reason-cards">
      <div class="reason-card">好きな理由をここに書きます。</div>
      <div class="reason-card">おいしそうな理由をここに書きます。</div>
    </div>
  </div>

  <!-- 理由：商品B -->
  <div class="reason-block">
    <h3 class="reason-title">商品B の選んだ理由</h3>
    <div class="reason-cards">
      <div class="reason-card">好きな理由をここに書きます。</div>
      <div class="reason-card">おいしそうな理由をここに書きます。</div>
    </div>
  </div>

</section>

<section id="features" class="section">
  <h2>3. それぞれの特徴</h2>

  <div class="product-card" id="product-a">
    <div class="thumb"><img src="商品A.png" alt="商品A"></div>
    <div class="product-info">
      <h3>商品Aの名前</h3>
      <p>ここに説明文が入ります。</p>
    </div>
  </div>

  <div class="product-card" id="product-b">
    <div class="thumb"><img src="商品B.png" alt="商品B"></div>
    <div class="product-info">
      <h3>商品Bの名前</h3>
      <p>ここに説明文が入ります。</p>
    </div>
  </div>

  <div class="product-card" id="product-c">
    <div class="thumb"><img src="商品C.png" alt="商品C"></div>
    <div class="product-info">
      <h3>商品Cの名前</h3>
      <p>ここに説明文が入ります。</p>
    </div>
  </div>

  <div class="product-card" id="product-d">
    <div class="thumb"><img src="商品D.png" alt="商品D"></div>
    <div class="product-info">
      <h3>商品Dの名前</h3>
      <p>ここに説明文が入ります。</p>
    </div>
  </div>

</section>

<footer class="footer">
  <p><a href="https://www.nantofukuno-h.tym.ed.jp/"><img src="南砺福野高等学校ロゴ.png" alt="南砺福野高等学校ロゴ" style="width:auto; height:16px;">南砺福野高等学校HP：https://www.nantofukuno-h.tym.ed.jp/</a></p>
  <p><a href="https://www.hinodeya-seika.com/"><img src="日の出屋製菓ロゴ.svg" alt="日の出屋製菓ロゴ" style="width:auto; height:16px;">日の出屋製菓HP：https://www.hinodeya-seika.com/</a></p>
</footer>

  
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/*
  CountAPI-based visitor counter + daily data + Chart.js graph
  - LocalStorage used to ensure 1 view / day per client
  - No server-side required
  - Insert this script near the end of the page (before </body>)
*/

(function(){
  // --- 設定 ---
  const NAMESPACE = '13Hsite_files_counter'; // 任意の英数字ネームスペースに変更可
  const TOTAL_KEY = 'total'; // 総数キー
  const DAILY_COLLECTION_PREFIX = 'day-'; // 日付キーの接頭辞 (例 day-2025-01-01)
  const LAUNCH_DATE = '2025-01-01'; // ここをカウント開始日に合わせてください
  const PIXELS_PER_DAY = 100; // 1日あたりの横幅(px)
  const MAX_LABELS = 12; // 横ラベルの最大個数（間引き量の目安）

  // --- ヘルパー ---
  function getDateStr(d = new Date()) {
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${dd}`;
  }
  function visitedKey(dateStr){ return `visited_${dateStr}`; }
  function dailyApiKey(dateStr){ return DAILY_COLLECTION_PREFIX + dateStr; }
  // URL helpers
  function countapiHitURL(namespace, key){
    // POST-like increment endpoint (GET also works)
    return `https://api.countapi.xyz/hit/${encodeURIComponent(namespace)}/${encodeURIComponent(key)}`;
  }
  function countapiGetURL(namespace, key){
    return `https://api.countapi.xyz/get/${encodeURIComponent(namespace)}/${encodeURIComponent(key)}`;
  }

  // --- インクリメント（LocalStorage 判定あり） ---
  async function incrementIfNeeded(){
    const today = getDateStr();
    if (localStorage.getItem(visitedKey(today))) {
      // すでに今日カウント済み → 取得のみ
      return await fetchTotals();
    }

    // 増やす：日別キーと総数をhit（CountAPIが自動で作る）
    try {
      // increment daily
      await fetch(countapiHitURL(NAMESPACE, dailyApiKey(today))).then(r => r.json());
      // increment total
      const totalResp = await fetch(countapiHitURL(NAMESPACE, TOTAL_KEY)).then(r => r.json());
      // mark visited
      localStorage.setItem(visitedKey(today), '1');
      // return totals (we already have total value from response)
      // But we'll also fetch day-by-day list for chart
      const { labels, data } = await fetchDailySeries();
      return { total: totalResp.value || 0, labels, data };
    } catch (e) {
      console.error('CountAPI hit failed', e);
      // fallback: try to still fetch totals
      return await fetchTotals();
    }
  }

  // --- 日別データ取得（ラベル array と data array を返す） ---
  async function fetchDailySeries(){
    const start = new Date(LAUNCH_DATE);
    const end = new Date();
    const labels = [];
    const keys = [];
    for (let d = new Date(start); d <= end; d.setDate(d.getDate()+1)) {
      const s = getDateStr(new Date(d));
      labels.push(s);
      keys.push(dailyApiKey(s));
    }

    // fetch all counts concurrently (small number of days -> ok)
    const promises = keys.map(k => fetch(countapiGetURL(NAMESPACE, k)).then(r => {
      if (!r.ok) return 0;
      return r.json().then(obj => obj.value || 0).catch(()=>0);
    }).catch(()=>0));
    const data = await Promise.all(promises);
    return { labels, data };
  }

  // --- 総数だけ取得（get） ---
  async function fetchTotals(){
    try {
      const totalResp = await fetch(countapiGetURL(NAMESPACE, TOTAL_KEY));
      const totalVal = (totalResp.ok) ? (await totalResp.json()).value || 0 : 0;
      const { labels, data } = await fetchDailySeries();
      return { total: totalVal, labels, data };
    } catch (e) {
      console.error('fetchTotals failed', e);
      return { total: 0, labels: [], data: [] };
    }
  }

  // --- Chart.js 描画 ---
  let visitorChart = null;
  function renderChart(labels, data){
    const canvas = document.getElementById('visitorChart');
    if (!canvas) return;
    const days = labels.length;
    const desiredWidth = Math.max(600, days * PIXELS_PER_DAY);
    canvas.style.width = desiredWidth + 'px';
    // destroy previous
    if (visitorChart) {
      visitorChart.destroy();
      visitorChart = null;
    }

    // ラベル間引き
    const step = Math.max(1, Math.ceil(labels.length / MAX_LABELS));

    const ctx = canvas.getContext('2d');
    visitorChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: '訪問者数',
          data: data,
          backgroundColor: '#d14a1f',
          borderRadius: 4,
          barThickness: Math.min(36, PIXELS_PER_DAY * 0.45)
        }]
      },
      options: {
        responsive: false,
        maintainAspectRatio: false,
        scales: {
          x: {
            ticks: {
              callback: function(value, index) {
                return (index % step === 0) ? labels[index] : '';
              },
              autoSkip: false
            },
            grid: { display: false },
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: '訪問者数' }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });
  }

  // --- 初期処理 ---
  async function initVisitorSection(){
    // increment if needed and get totals + series
    const res = await incrementIfNeeded();
    // set total display
    const totalEl = document.getElementById('visitor-number');
    if (totalEl) totalEl.textContent = res.total || 0;
    // render chart
    if (res.labels && res.labels.length > 0) {
      renderChart(res.labels, res.data);
    } else {
      // no data yet: empty chart or message
      const canvas = document.getElementById('visitorChart');
      if (canvas) {
        canvas.parentNode.innerHTML = '<p style="color:#666;">まだデータがありません。</p>';
      }
    }
  }

  document.addEventListener('DOMContentLoaded', function(){
    initVisitorSection().catch(e => console.error(e));
  });

})();
</script>
</body>
</html>






